LETTER

doi:10.1038/nature09880

Functional specificity of local synaptic connections
in neocortical networks
¨stro
¨m1 & Thomas D. Mrsic-Flogel1
Ho Ko1*, Sonja B. Hofer1*, Bruno Pichler1{, Katherine A. Buchanan1, P. Jesper Sjo

and carried out simultaneous whole-cell patch-clamp recordings
from up to four neighbouring L2/3 pyramidal neurons (mean distance 6 standard deviation (s.d.) 5 25 6 9 mm). Synaptic connectivity
a

b

119 μm

Δd = 7 μm

…. …. or

…. ….

.....…

Neuronal connectivity is fundamental to information processing
in the brain. Therefore, understanding the mechanisms of sensory
processing requires uncovering how connection patterns between
neurons relate to their function. On a coarse scale, long-range
projections can preferentially link cortical regions with similar
responses to sensory stimuli1–4. But on the local scale, where dendrites and axons overlap substantially, the functional specificity of
connections remains unknown. Here we determine synaptic connectivity between nearby layer 2/3 pyramidal neurons in vitro, the
response properties of which were first characterized in mouse
visual cortex in vivo. We found that connection probability was
related to the similarity of visually driven neuronal activity.
Neurons with the same preference for oriented stimuli connected
at twice the rate of neurons with orthogonal orientation preferences. Neurons responding similarly to naturalistic stimuli formed
connections at much higher rates than those with uncorrelated
responses. Bidirectional synaptic connections were found more
frequently between neuronal pairs with strongly correlated visual
responses. Our results reveal the degree of functional specificity of
local synaptic connections in the visual cortex, and point to the
existence of fine-scale subnetworks dedicated to processing related
sensory information.
Paired intracellular recordings in cortical slices indicate that synaptic
connectivity between neighbouring neurons is heterogeneous and
depends on factors such as cell type, electrophysiological properties
and long-range targets5–10. In fact, even within relatively homogenous
groups of neurons, connectivity is not uniformly distributed5,6. Although
this non-random connectivity raises the possibility that functionally
similar neurons form synaptically coupled subnetworks6,7, the relationship between a neuron’s synaptic partners and their functional properties
in local cortical circuits has not been determined.
To elucidate this relationship, we developed an approach to relate
connectivity to function in identified neurons of the layer 2/3 (L2/3)
network in mouse visual cortex (V1), where neurons with diverse preferences for sensory stimuli are locally intermixed11,12. In anaesthetized
mice, the monocular region of V1 was bulk labelled with injections of
the calcium indicator dye OGB-1 AM and the astrocyte marker SR101
(ref. 13) (see Methods). We first used in vivo two-photon imaging14,15 to
sample spike-related somatic calcium signals from L2/3 neurons during
presentation of drifting gratings and natural movie sequences (see
Methods). We repeated this mapping at consecutive depths beneath
the cortical surface to characterize visually evoked responses of all
neurons within a cortical volume of approximately 285 3 285 3 90
mm3, starting at the upper border of L2/3 (Fig. 1a, b; depth range
covered 60–120 mm). In this way, we obtained information about orientation/direction tuning and response correlation from a complete
sample of L2/3 neurons (Fig. 1c, d).
We then identified the same OGB-1-filled neurons in acute slices
(Figs 1e–h, 2a) by registering image stacks obtained in vivo and in vitro
using affine transformation (see Methods and Supplementary Fig. 1),

20%
ΔF/F
10 s

285 μm

c

d

Preferred
orientation

Signal
correlation

135º
90º
45º
0º
50 μm

e

f

In vivo stack

In vitro

Affine
transformation

30 μm

30 μm

g

In vivo

h

In vitro

30 μm

Figure 1 | Imaging functional properties of neurons in vivo and
indentifying the same neurons in vitro. a, Two-photon imaging was used to
sample somatic calcium signals from a complete population of L2/3 neurons
within a 285 3 285 3 119 mm3 volume. Imaging was carried out at 7 mm depth
increments (Dd 5 7 mm). Neurons were labelled with the calcium indicator dye
OGB-1 AM (green) and the astrocyte marker SR101 (red). b, Example traces of
calcium signals from four different cells in the imaged volume while presenting
six trials of grating stimuli drifting in eight different directions. c, All orientationselective cells in the volume were colour-coded according to preferred orientation
and plotted as spheres. d, Signal correlations were computed from average
responses to natural movies. Red lines represent strongly correlated neuronal
pairs (signal correlation .0.2). e, f, After imaging visually evoked calcium signals,
a detailed image stack was obtained in vivo. The brain was sliced coronally and
another stack of the same tissue was obtained in vitro (a single optical plane is
shown in f). Affine transformation was used to align the in vivo to the in vitro
stack, allowing precise matching of OGB-1-filled cells in the two stacks.
g, h, Close-ups of the regions outlined with dashed lines in e and f, respectively.

1

Department of Neuroscience, Physiology and Pharmacology, University College London, 21 University Street, London WC1E 6DE, UK. {Present address: MRC National Institute for Medical Research, The
Ridgeway, Mill Hill, London NW7 1AA, UK.
*These authors contributed equally to this work.
5 M AY 2 0 1 1 | VO L 4 7 3 | N AT U R E | 8 7

©2011 Macmillan Publishers Limited. All rights reserved

RESEARCH LETTER
In vitro

In vitro patched
4
3

30 μm

b

1
2

Orientation
tuning 90˚

4

1
0˚

180˚

1

270˚

2
3
4

3

2

20% ΔF/F
1s

c
40 mV

2

1

3
1

3
2

4

4

1

1

2
3

2
4

4

3
0.4 mV

e
0.5

P = 0.040
10/26

0.25

11/44
4/24

0

0
45
90
ΔOri (degree)

40 ms

Connection probability

Connection probability

d

0.5 6/13

2/5

4/16

0.25

0

P = 0.034

3/16

0

4/22

45
90
135
ΔDir (degree)

180

Figure 2 | Relating orientation and direction preference to connection
probability among L2/3 pyramidal neurons. a, White circles denote the
locations of in vivo to in vitro matched cells that were targeted for whole-cell
recording and filled with Alexa 594. b, Left panel shows average calcium
responses of the four cells to oriented drifting gratings. Right panel shows
corresponding polar plots of inferred spike rate responses, normalized to the
maximum response of cell 4. Three of the cells (cells 2, 3 and 4) were reliably
responsive and orientation selective. Arrow shows a connection detected from
cell 3 to cell 2. c, Membrane potential recordings from the four cells. Currents
were injected into each cell in sequence, and from average traces of postsynaptic
potentials an excitatory connection was found from cell 3 to cell 2. No other
connections were found. Vertical dashed lines indicate timing of presynaptic
spikes. In some traces, stimulation artefacts are visible that coincided exactly
with presynaptic spikes and therefore could be clearly distinguished from EPSPs.
d, Relationship between connection probability and difference in preferred
orientation (DOri) among pairs in which both neurons were responsive to
grating stimuli and were orientation selective (OSI .0.4). There was a significant
decreasing trend in connection probability as DOri increased (P 5 0.040,
Cochran–Armitage test). Dotted line indicates connection probability for all
pairs included in this analysis (25/94, 0.27). The bins include difference in
orientation values of 0 to 22.5u (0 degree bin), 22.5u to 67.5u (45 degree bin), and
67.5u to 90u (90 degree bin). e, Relationship between connection probability and
difference in preferred direction (DDir) in the subset of neurons that were
direction-selective (DSI .0.3). The same decreasing trend with respect to DOri
was detected (P 5 0.034, Cochran–Armitage test). Neurons connected with
specificity to preferred orientation but not to preferred direction. Dotted line
indicates connection probability for all directionally selective pairs (19/72, 0.26).
The bins include difference in orientation values of 0 to 22.5u (0 degree bin),
22.5u to 67.5u (45 degree bin), and so on.

between cells was assessed by evoking action potentials in each neuron
in turn while simultaneously recording membrane potential in the
other neurons. Monosynaptic connections appeared as spike-locked

postsynaptic potentials with millisecond latency (mean latency 6
s.e.m. 5 1.69 6 0.11 ms; see Figs 2c, 3b for sample traces). This
approach allowed us to determine connectivity rates and patterns
(unidirectional, bidirectional), and to relate these to cell functionality
in the intact brain (Figs 1c, d, 2b, 3a).
The data set contained imaging experiments performed on 16 mice
and whole-cell recordings from 126 L2/3 pyramidal cells, 116 of which
could be matched to neurons functionally characterized in vivo (see
Methods). The rate of connectivity was 0.19 (43 connections out of 222
potential connections assayed), in keeping with previous reports6,10.
Connection probability, synaptic strength and electrophysiological
properties of OGB-1-labelled neurons were not significantly different
to those recorded in slices from naive age-matched visual cortex that
was not injected with OGB-1 AM (connectivity rate 0.18; 25 connected
of 143 tested; Supplementary Fig. 2), indicating that dye loading,
anaesthesia and prolonged exposure to infrared laser light during
imaging in vivo did not alter these parameters.
We first examined how connectivity depended on orientation selectivity and on responsiveness to natural movies. Out of the 116 neurons,
77 were responsive to the natural movie, and 79 were orientation selective for grating stimuli (see Methods). Connection probability between
orientation-tuned neurons was more than twofold higher than among
non-selective and/or non-responsive cells (0.27; 25/94 versus 0.10; 3/31;
P 5 0.050, chi-squared test). The connectivity rate between neurons
responsive to the natural movie was significantly higher than among
cells non-responsive to the movie (0.28; 30/108 versus 0.04; 2/48;
P 5 0.001, chi-squared test). Taken together, these data indicate that
reliably responsive and feature-selective neurons belong to more
densely interconnected neocortical subnetworks.
We then related connection probability to neuronal preference for the
angle and direction of drifting gratings (Fig. 2). For this analysis, we only
included pairs in which both neurons were responsive (74/113), orientation selective (orientation selectivity index (OSI) .0.4; 53/74), or
direction selective (direction selectivity index (DSI) .0.3; 41/53; see
Methods and Supplementary Fig. 3a–c). Connectivity rate decreased
with increasing difference in orientation preference (P 5 0.040,
Cochran–Armitage test for trend; Fig. 2d). For similarly tuned cells,
a

b
0.31

1

2

–0.03

1

1

0.00 2

3

0.5

5s

P = 0.0002

10/20

3/6

12/38

0.3
5/37

0.1
0

0/7
–0.1

2
3

2

1
3

3

5%
ΔF/F

0.4
0.2

1

3

3

c

2

0
0.1
0.2
Signal correlation

0.3

d

Connection probability

In vivo

Connection probability

a

40 mV
40 ms

0.7
0.6
0.5
0.4
0.3
0.2
0.1
0

1
2
0.1 mV
40 ms

P = 0.011

4/6

3/16
0/2
–0.1
0
0.1
Noise correlation

Figure 3 | Relationship between response correlation to natural movies and
connection probability. a, An example of a triplet of neurons targeted for
whole-cell recording in vitro, with associated in vivo calcium responses to the
natural movie (average of six repetitions) and spike rate correlation values.
Neuron 1 and 2 showed correlated firing (signal correlation 5 0.31), whereas
other pairs did not. b, Triple recordings from the same neurons reveal the pattern
of connections: neurons 1 and 2 were bidirectionally connected, whereas neuron
3 provided input to neuron 1. Dashed lines indicate timing of presynaptic spikes.
c, There was a significant increase in connection probability with increasing
signal correlation to natural movies (P 5 0.0002, Cochran–Armitage test).
Dotted line indicates connection probability for all pairs included in this analysis
(30/108, 0.28). d, Connection probability increased significantly with increase in
noise correlation (P 5 0.011, Cochran–Armitage test). Correlation values were
binned, with ranges from 20.15 to 20.05, from 20.05 to 0.05, and so on.

8 8 | N AT U R E | VO L 4 7 3 | 5 M AY 2 0 1 1

©2011 Macmillan Publishers Limited. All rights reserved

LETTER RESEARCH
(Supplementary Fig. 4c, f; also see Supplementary Fig. 5), although
the sample size may not be large enough to rule out subtle trends.
Correlated variability in neuronal firing independent of a sensory
stimulus is assumed to reflect neuronal connectivity in the network17–19.
Correlated fluctuations in neuronal firing may either be driven by
common input or by recurrent synaptic connections, or both. For a
subset of visually responsive neuronal pairs (12/56) that were imaged
simultaneously in vivo (that is, on the same optical planes), we computed noise correlations (see Methods), which provide an indication of correlated response variability. Noise correlations were low
(mean 6 s.d. 5 0.02 6 0.04). Despite the small sample size, connection
probability was found to increase significantly with increase in noise
correlation (Fig. 3d; P 5 0.011, Cochran–Armitage test), indicating that
recurrent connectivity may contribute to correlated fluctuations of
neuronal firing.
We next compared how visual response similarity relates to connectivity motifs in the local network. Previous work indicates that bidirectional connections are overrepresented in a network of sparsely
connected pyramidal neurons5. We found that the connectivity bias
between neurons responding similarly to drifting gratings or to natural
movies was further accentuated when investigating the distribution of
unidirectionally or bidirectionally connected pairs (Fig. 4). We found a
decreasing trend relating probability of bidirectional connections
and difference in orientation preference (Fig. 4a, b; P 5 0.070 for all
orientation-selective pairs; P 5 0.036 for direction-selective pairs,
Cochran–Armitage test). Importantly, the monotonic fall-off in the
incidence of bidirectional motifs was steeper than the overall decrease
in probability of finding connected pairs as DOri increased (Fig. 4a, b).
Similarly, the incidence of bidirectional connections increased sharply as
signal correlation to natural movies increased (P 5 0.003, Cochran–
Armitage test; Fig. 4c), such that signal correlation was almost threefold
higher for recurrently connected pairs than unconnected pairs (mean
signal correlation of bidirectionally connected pairs 6 s.d. 5 0.16 6 0.07
versus 0.06 6 0.10 for unconnected pairs; P 5 0.01, rank sum test). As
the probability of unidirectionally connected pairs did not show a monotonic trend with increase in response similarity (Fig. 4a–c; P . 0.4 for all
conditions, Cochran–Armitage test), reciprocal connectivity reflects
functional similarity better than does unidirectional connectivity.
In this study, we have characterized the functional specificity of local
connections in mouse V1. Our results demonstrate that connectivity
between neighbouring neurons (,50 mm apart) is not random, but
specifically structured; visually driven neurons were more likely to
connect to each other, and this probability increased with the degree
of their response similarity. This relationship between connectivity
and function was stronger when comparing responses to natural sensory
input than for relatively artificial grating stimuli.
We have shown in mouse V1 that—although a given neuron
receives input from nearby neurons preferring a wide range of stimulus

connection probability was high (0.38; 10/26; difference in preferred
orientation (DOri) ,22.5u), more than twofold higher than for cells with
a large difference in orientation preference (0.17; 4/24; DOri .67.5u).
Thus, neuronal pairs similarly tuned for orientation were more likely to
connect to each other, although a considerable connectivity rate was still
observed between neurons tuned to dissimilar or orthogonal orientations. These results are consistent with the narrow suprathreshold yet
broader subthreshold tuning for orientation and direction in mouse V1
neurons16. The same decrease of connection probability with increase in
DOri was found for direction selective pairs (P 5 0.034, Cochran–
Armitage test; Fig. 2e), but these neurons only connected specifically
with respect to orientation not preferred direction (Fig. 2e). These data
indicate that directional preference is not conferred by biased local
excitatory input, so other cell intrinsic or network mechanisms (for
example, biased long range input, specific inhibition) may be needed
to explain the emergence of direction selectivity. Varying the criteria for
orientation or direction selectivity (OSI/DSI from 0.2 to 0.6) did not
change the dependence of connectivity on difference in orientation/
direction preference (Supplementary Fig. 3d, e), indicating that neurons
that are broadly or sharply tuned both tend to connect preferentially to
others with similar functional preference. In our data set we did not find
evidence indicating that neurons with similar preferred orientations or
directions are connected by stronger (excitatory postsynaptic potential
(EPSP) amplitude) or more facilitating (paired-pulse ratio (PPR)) connections than neurons with different preferred orientations or directions
(Supplementary Fig. 4a, b, d, e; also see Supplementary Fig. 5 for a sample
pair with strong connections), although the sample size may not be
adequate for ruling out any subtle trends.
The visual cortical circuit is constantly engaged in processing natural
scenes, so statistical dependencies between neuronal activities in the
presence of such stimuli may reflect connectivity. We therefore tested
how network connectivity relates to the similarity of neuronal responses
during the presentation of stimuli with natural spatiotemporal statistics
(Fig. 3, see Methods). For each neuronal pair in which both neurons
responded reliably to natural movies (56/113), we computed the timevarying firing-rate correlation of average responses (signal correlation)
to repeated presentations of a 30 to 40-s-long natural movie sequence
(Fig. 3a). On average, signal correlations were low (mean 6 s.d. 5 0.08
6 0.10). The probability of finding a connection between two neurons
significantly increased with signal correlation to natural movies
(P 5 0.0002, Cochran–Armitage test; Fig. 3c). For pairs with close to
zero or weakly negative signal correlation (,0.05), the connection
probability was low (0.11, 5/44). In contrast, for neuronal pairs with
stronger signal correlation (.0.15), the connection probability was
more than fourfold higher (0.5; 13/26). Therefore, connectivity in
mouse visual cortex is highly selective with respect to neuronal responses to natural movies. EPSP amplitude and PPR, however, were
not found to change significantly with increase in signal correlation

Probability of finding
connected pairs

0.4
0.3

11

P = 0.070

1
4

21
9

0.2
0.1
0

5
3

1
1

0
45 90
ΔOri (degree)

0.5

6
3

P = 0.036

0.4

8
7

0.3
0.2

1
1

0.1
0

c

2
1

Probability of finding
connected pairs

b
0.5

Probability of finding
connected pairs

a

0

8
1
1

2
1

45 90 135 180
ΔDir (degree)

Figure 4 | Relationship between similarity of visual responses and
probability of finding unidirectionally and bidirectionally connected pairs.
a, Among orientation-selective neurons, the probability of finding connected pairs
decreased as DOri increased. The fall-off in probability of finding bidirectionally
connected pairs was steeper than the decrease in overall probability of finding
connected pairs. A trend of decrease in probability of finding bidirectionally
connected pairs was found (P 5 0.070, Cochran–Armitage test). b, The same

0.7
0.6

P = 0.003

3
10

0.5
18

0.4
18
5

0.3
0.2
0.1
0

3
–0.1

3
4

2
4

1
1

Unidirectional
Bidirectional

0
0.1 0.2 0.3
Signal correlation

observation holds in the subset of directionally selective pairs, and the probability
of finding bidirectionally connected pairs decreased as DOri increased (P 5 0.036,
Cochran–Armitage test). c, The probability of finding bidirectionally connected
pairs increased sharply as signal correlation to natural movies increased
(P 5 0.003, Cochran–Armitage test). Dotted lines indicate the probability of
finding connected pairs from all pairs included in analysis (panel a: 15/41, 0.37;
panel b: 11/31, 0.35; panel c: 20/52, 0.38).
5 M AY 2 0 1 1 | VO L 4 7 3 | N AT U R E | 8 9

©2011 Macmillan Publishers Limited. All rights reserved

RESEARCH LETTER
orientations—more than twice as many connections are made between
similarly tuned neurons as between disparately tuned cells. In keeping,
subthreshold tuning in L2/3 pyramidal neurons in mouse V1 is broad
but nonetheless biased towards the preferred orientation16. This is
similar to the tuning of neurons in pinwheel centres of orientation
maps in visual cortex of other species20. In carnivores and primates,
long-range horizontal projections in L2/3 (.500 mm) are biased
towards cortical columns with similar orientation preference1–4. Our
results indicate that similar principles of connectivity apply at the
level of local neocortical networks in the mouse—a species without
columnar architecture—indicating that functionally biased connectivity
may be a general feature of organization in the visual cortex. In the visual
cortex this selective connection scheme may serve as a mechanism for
the amplification of thalamic input and sharpening of tuning21,22 or for
local contour integration23.
Analysis of connectivity rate with respect to similarity of responses
to natural movies revealed a marked degree of specificity of local connections (Fig. 3c, d). Connection probability increased sharply with
increase in both signal and noise correlation to natural movies.
Neurons with higher signal correlations to natural movies probably
share similar receptive field structures, and may therefore be driven by
common feed-forward input24. Our results are therefore consistent
with the finding that L2/3 pyramidal neurons form highly interconnected subnetworks sharing common input from layer 4 in slices of rat
visual cortex6. Developmentally, this organization of lateral connections based on receptive field similarity may arise through activitydependent synaptic plasticity, whereby neurons driven by common
input develop stable bidirectional connections25. Indeed, our data show
that the majority of bidirectionally connected neurons had stronger
signal correlations to natural movies and shared similar orientation
preference. As individual neurons show variability in their responses
to the same visual stimulus26, recurrent excitation between similarly
tuned neurons may reduce response variance, while introducing
redundancy into the population code for robustness against errors27.
Our results do not preclude the possibility that other factors—
including inhibitory connections or synaptic strength—also contribute
to functional specificity in the circuit. Because inhibition, in particular,
may be important in determining the receptive field properties of
neurons in V1 (ref. 28), it will be important to examine the extent to
which inhibitory connections are functionally specific7.
Using a novel and relatively straightforward approach for in vitro
mapping of synaptic connectivity among neurons that had been identified functionally in vivo, we found that neighbouring neurons with
similar feature selectivity preferentially but not exclusively connected
to each other in L2/3 of mouse V1. Together with other powerful
approaches29,30, our method can be used to uncover functional biases
of connectivity between different cell types and cortical layers, and in
other brain areas. This information will be critical for understanding
the functional wiring of circuits mediating perception and behaviour.

METHODS SUMMARY

30–90 times. Connection probability is the number of detected connections over
the total number of potential connections assayed. Probability of finding uni- or
bidirectionally connected pairs was calculated as the number of uni- or bidirectionally connected pairs over the total number of pairs. To register in vivo and in
vitro image stacks and to match the same neurons imaged in vivo and recorded
from in vitro, three-dimensional image registration by affine transformation using
custom-written MATLAB software was performed subsequent to the experiment.
To relate connectivity to functional properties, the asymptotic Cochran–Armitage
test for trend was used to test for significance.
Full Methods and any associated references are available in the online version of
the paper at www.nature.com/nature.
Received 8 September 2010; accepted 1 February 2011.
Published online 10 April 2011.
1.

2.

3.
4.

5.
6.
7.
8.
9.

10.

11.
12.

13.

14.
15.
16.
17.
18.
19.

20.
21.

Anaesthetized C57Bl/6 mice between postnatal day 22 and 26 were injected with
the calcium-sensitive dye Oregon Green Bapta-1 AM into monocular V1 as
described previously11 and in vivo two-photon calcium imaging14,15 was used to
record responses of layer 2/3 neurons to eight different drifting square-wave
gratings (0.035 cycles per degree, 2 cycles s21, 100% contrast) and natural movie
sequences. Spike trains were inferred from calcium signals using a non-negative
deconvolution method. Preferred orientation and direction, as well as OSI and DSI
were calculated using Fourier-interpolated tuning curves. Pearson’s correlation
coefficient was used to obtain pair-wise response correlations, either from average
responses to the stimulus (signal correlation) or from mean-subtracted responses
(noise correlation). Small volumes of fluorescent microspheres were injected into
the imaged region to facilitate identification of the region in the sliced brain.
Coronal slices were cut after dissection of the brain, and whole-cell recordings
from up to four cells simultaneously were carried out in the vicinity of the microsphere tract (identified by two-photon microscopy). The presence of synaptic
connections was tested by evoking five spikes at 30 Hz in each cell, repeated

22.
23.
24.

25.

26.
27.
28.
29.

Bosking, W. H., Zhang, Y., Schofield, B. & Fitzpatrick, D. Orientation selectivity and
the arrangement of horizontal connections in tree shrew striate cortex. J. Neurosci.
17, 2112–2127 (1997).
Gilbert, C. D. & Wiesel, T. N. Columnar specificity of intrinsic horizontal and
corticocortical connections in cat visual cortex. J. Neurosci. 9, 2432–2442
(1989).
Roerig, B. & Kao, J. P. Organization of intracortical circuits in relation to direction
preference maps in ferret visual cortex. J. Neurosci. 19, RC44 (1999).
Weliky, M., Kandler, K., Fitzpatrick, D. & Katz, L. C. Patterns of excitation and
inhibition evoked by horizontal connections in visual cortex share a common
relationship to orientation columns. Neuron 15, 541–552 (1995).
Song, S., Sjo¨stro¨m, P. J., Reigl, M., Nelson, S. & Chklovskii, D. B. Highly nonrandom
features of synaptic connectivity in local cortical circuits. PLoS Biol. 3, e68 (2005).
Yoshimura, Y., Dantzker, J. L. M. & Callaway, E. M. Excitatory cortical neurons form
fine-scale functional networks. Nature 433, 868–873 (2005).
Yoshimura, Y. & Callaway, E. M. Fine-scale specificity of cortical networks depends
on inhibitory cell type and connectivity. Nature Neurosci. 8, 1552–1559 (2005).
Brown, S. P. & Hestrin, S. Intracortical circuits of pyramidal neurons reflect their
long-range axonal targets. Nature 457, 1133–1136 (2009).
Thomson, A. M., Bannister, A. P., Mercer, A. & Morris, O. T. Target and temporal
pattern selection at neocortical synapses. Phil. Trans. R. Soc. Lond. B 357,
1781–1791 (2002).
Holmgren, C., Harkany, T., Svennenfors, B. & Zilberter, Y. Pyramidal cell
communication within local networks in layer 2/3 of rat neocortex. J. Physiol.
(Lond.) 551, 139–153 (2003).
Mrsic-Flogel, T. D. et al. Homeostatic regulation of eye-specific responses in visual
cortex during ocular dominance plasticity. Neuron 54, 961–972 (2007).
Ohki, K., Chung, S., Ch’ng, Y. H., Kara, P. & Reid, R. C. Functional imaging with
cellular resolution reveals precise micro-architecture in visual cortex. Nature 433,
597–603 (2005).
Nimmerjahn, A., Kirchhoff, F., Kerr, J. N. D. & Helmchen, F. Sulforhodamine 101 as
a specific marker of astroglia in the neocortex in vivo. Nature Methods 1, 31–37
(2004).
Denk, W., Strickler, J. H. & Webb, W. W. Two-photon laser scanning fluorescence
microscopy. Science 248, 73–76 (1990).
Stosiek, C., Garaschuk, O., Holthoff, K. & Konnerth, A. In vivo two-photon calcium
imaging of neuronal networks. Proc. Natl Acad. Sci. USA 100, 7319–7324 (2003).
Jia, H., Rochefort, N. L., Chen, X. & Konnerth, A. Dendritic organization of sensory
input to cortical neurons in vivo. Nature 464, 1307–1312 (2010).
Alonso, J. M. & Martinez, L. M. Functional connectivity between simple cells and
complex cells in cat striate cortex. Nature Neurosci. 1, 395–403 (1998).
Kohn, A. & Smith, M. A. Stimulus dependence of neuronal correlation in primary
visual cortex of the macaque. J. Neurosci. 25, 3661–3673 (2005).
Aertsen, A. M., Gerstein, G. L., Habib, M. K. & Palm, G. Dynamics of neuronal firing
correlation: modulation of ‘‘effective connectivity’’. J. Neurophysiol. 61, 900–917
(1989).
Marin˜o, J. et al. Invariant computations in local cortical networks with balanced
excitation and inhibition. Nature Neurosci. 8, 194–201 (2005).
Ben-Yishai, R., Bar-Or, R. L. & Sompolinsky, H. Theory of orientation tuning in visual
cortex. Proc. Natl Acad. Sci. USA 92, 3844–3848 (1995).
Douglas, R. J., Koch, C., Mahowald, M., Martin, K. A. & Suarez, H. H. Recurrent
excitation in neocortical circuits. Science 269, 981–985 (1995).
Li, W., Pie¨ch, V. & Gilbert, C. D. Contour saliency in primary visual cortex. Neuron 50,
951–962 (2006).
Alonso, J. M., Usrey, W. M. & Reid, R. C. Rules of connectivity between geniculate
cells and simple cells in cat primary visual cortex. J. Neurosci. 21, 4002–4015
(2001).
Clopath, C., Bu¨sing, L., Vasilaki, E. & Gerstner, W. Connectivity reflects coding: a
model of voltage-based STDP with homeostasis. Nature Neurosci. 13, 344–352
(2010).
Tolhurst, D. J., Movshon, J. A. & Dean, A. F. The statistical reliability of signals in
single neurons in cat and monkey visual cortex. Vision Res. 23, 775–785 (1983).
Barlow, H. Redundancy reduction revisited. Network 12, 241–253 (2001).
Alitto, H. J. & Dan, Y. Function of inhibition in visual cortical processing. Curr. Opin.
Neurobiol. 20, 340–346 (2010).
Marshel, J. H., Mori, T., Nielsen, K. J. & Callaway, E. M. Targeting single neuronal
networks for gene expression and cell labeling in vivo. Neuron 67, 562–574
(2010).

9 0 | N AT U R E | VO L 4 7 3 | 5 M AY 2 0 1 1

©2011 Macmillan Publishers Limited. All rights reserved

LETTER RESEARCH
30. Denk, W. & Horstmann, H. Serial block-face scanning electron microscopy to
reconstruct three-dimensional tissue nanostructure. PLoS Biol. 2, e329 (2004).
Supplementary Information is linked to the online version of the paper at
www.nature.com/nature.
Acknowledgements We thank T. Margrie for discussions about the project and the
manuscript, and J. Vogelstein for the spike inference algorithm. This work was
supported by the Wellcome Trust (T.D.M.-F.), the European Research Council
(T.D.M.-F.), the European Molecular Biology Organisation (S.B.H.), the Medical
Research Council and FP7 grant #243914 (K.A.B., P.J.S.), the Overseas Research
Students Award Scheme and UCL studentship (H.K.).

Author Contributions H.K. and S.B.H. performed experiments and data analysis. H.K.
developed image registration software using preliminary data obtained by S.B.H. and
K.A.B., and programs for data analysis. B.P. developed image acquisition software and
the program for extracting calcium transients. P.J.S. designed electrophysiology setup
and software for acquisition and analysis. B.P., H.K., S.B.H. and T.D.M.-F. built
experimental setups. H.K. and T.D.M.-F. wrote the paper.
Author Information Reprints and permissions information is available at
www.nature.com/reprints. The authors declare no competing financial interests.
Readers are welcome to comment on the online version of this article at
www.nature.com/nature. Correspondence and requests for materials should be
addressed to T.D.M.-F. (t.mrsic-flogel@ucl.ac.uk).

5 M AY 2 0 1 1 | VO L 4 7 3 | N AT U R E | 9 1

©2011 Macmillan Publishers Limited. All rights reserved

RESEARCH LETTER
METHODS
Animals and surgical procedures. All experimental procedures were carried out in
accordance with institutional animal welfare guidelines and were licensed by the UK
Home Office. Experiments were performed on C57Bl/6 mice between postnatal day
22–26, when both intrinsic and visually driven cortical responses exhibit a relatively
mature phenotype31,32. Mice were initially anaesthetized with a mixture of Fentanyl
(0.05 mg kg21), Midazolam (5.0 mg kg21), and Medetomidin (0.5 mg kg21). Light
anaesthesia was maintained during recordings by isoflurane (0.3–0.5%) in a 60:40%
mixture of O2:N2O delivered via a small nose cone. Surgery was performed as
described previously11. Briefly, a small craniotomy (1–2 mm) was carried out over
primary visual cortex and sealed after dye injection with 1.6% agarose in HEPESbuffered artificial cerebrospinal fluid (ACSF) and a cover slip.
Dye loading and two-photon calcium imaging in vivo. For bulk loading of
cortical neurons, the calcium-sensitive dye Oregon Green Bapta-1 AM (OGB-1
AM; Molecular Probes) was first dissolved in 4 ml DMSO containing 20% Pluronic
F-127 (Molecular Probes), and further diluted (1/11) in dye buffer (150 mM NaCl,
2.5 mM KCl and 10 mM HEPES (pH 7.4)) to yield a final concentration of 0.9 mM.
Sulphorhodamine 101 (SR101, 50 mM; Molecular Probes) was added to the solution to distinguish astrocytes from neurons13. The dye was slowly pressureinjected into the right visual cortex at a depth of 150–200 mm with a micropipette
(3–5 MV, 3–10 psi, 2–4 min) under visual control by two-photon imaging (310
water immersion objective, Olympus). Activity of cortical neurons was monitored
by imaging fluorescence changes with a custom-built microscope and a modelocked Ti:sapphire laser (Mai Tai, Spectra-Physics) at 830 nm through a 340 water
immersion objective (0.8 NA, Olympus). Scanning and image acquisition were
controlled by custom software written in LabVIEW (National Instruments). The
average laser power delivered to the brain was ,50 mW.
Imaging frames of 256 3 256 pixels were acquired at 7.6 Hz, starting at ,110
mm below cortical surface, corresponding to superficial layer 2 in mouse V1. After
each recording, the focal plane and imaging position was checked and realigned
with the initial image if necessary. To obtain visually evoked responses from all
neurons in a cortical volume of approximately 285 3 285 3 60–120 mm3, images
were recorded at 9 to 18 cortical depths with a spacing of 7 mm. At the end of each
experiment, fluorescent microspheres (Lumafluor) were carefully pressureinjected into the imaged volume with a glass pipette, resulting in small fluorescent
landmarks (5–20 mm diameter) along the pipette track. These landmarks were
used to assist in subsequent identification of the imaged region in the sliced brain
(see later), as well as fine-scale registration of in vivo and in vitro image stacks.
Visual stimulation. Visual stimuli were generated using MATLAB Psychophysics
Toolbox33,34, and displayed on an LCD monitor (60 Hz refresh rate) positioned
20 cm from the left eye, roughly at 45 degrees to the long axis of the animal,
covering ,105 3 85 degrees of visual space. At the beginning of each experiment,
the appropriate retinotopic position in visual cortex was determined using small
grating stimuli at 12–24 neighbouring positions. Only cortical regions in the
monocular part of primary visual cortex were included in the analysis. The monitor was repositioned such that the preferred retinotopic position of most imaged
neurons was roughly in the middle of the monitor. Calcium signals were measured
in response to sequences of full-field grating stimuli and natural movies. Squarewave gratings (0.035 cycles per degree, 2 cycles s21, 100% contrast) drifting in eight
different directions were randomly interleaved, with the grating standing for 1.4–
1.9 s before moving for 0.9–1.5 s (six repetitions per grating). Naturalistic movies
consisted of 30 or 40 s sequences of moving scenes compiled from David
Attenborough’s Life of Mammals (BBC) and cage scenes from a head-mounted
mouse camera, adjusted to 70% mean contrast (repeated 4–7 times).
Analysis of calcium signals. Image sequences were aligned for tangential drift and
analysed with custom programs written in ImageJ (NIH), MATLAB (Mathworks)
and LabVIEW. Recordings with significant brain movements, vertical drift, or
both were excluded from further analysis. Outlines of neurons recorded were
semi-automatically defined using software written in MATLAB (Mathworks).
All pixels within each ROI were averaged to give a single time course (DF/F),
which was additionally high-pass filtered at a cut-off frequency of 0.02 Hz to
remove slow fluctuations in the signal.
Spike trains were inferred from calcium signals using a fast non-negative deconvolution method that approximates the maximum a posteriori spike train for each
neuron, given the fluorescence observations35. Performance of the algorithm was
tested by cell-attached recordings performed simultaneously with calcium
imaging. There was a close correspondence between inferred and recorded spike
rates (mean correlation 6 s.d. 5 0.82 6 0.06; nine cells from four animals).
Visual responsiveness was determined by the following procedure. For all
stimulus repetitions, inferred spike trains were moving-average filtered with a
time window of three frames (,0.394 s). The smoothed firing rates at corresponding points of the stimulus were then treated as groups and tested for differences by
one-way ANOVA. Neurons with a P value less than 0.05 were considered visually

responsive. This allowed neurons that exhibited consistent elevated firing during at
least one period of stimulus presentation to be detected. Among cells responsive to
grating stimuli, the sum of firing rates of eight frames (,1.05 s) 0.13 s after the onset
of grating drift was taken as the response to each stimulus. Responses from different
trials were averaged to obtain the orientation tuning curve. This orientation tuning
curve was then Fourier interpolated to 360 points, and the preferred direction was
determined by the angle at which the interpolated tuning curve attained its maximum. The preferred orientation was taken as the modulus of the preferred direction
to 180 degrees. OSI was calculated as (Rbest 2 Rortho)/(Rbest 1 Rortho), where Rbest is
the interpolated response to the best direction, and Rortho is the average of interpolated responses to the directions orthogonal to best responding direction. DSI was
calculated as 1 2 Rnull/Rbest, where Rnull is the interpolated response to the angle
opposite the best responding direction. When relating connection probability to
orientation selectivity or direction selectivity, neurons were defined to be orientation
selective if OSI .0.4, and direction selective if DSI .0.3. Varying these criteria from
0.2 to 0.6 did not change the results (Supplementary Fig. 3). We used Pearson’s
correlation coefficient to obtain pair-wise response correlations for cell pairs, using
estimated spike rates. Signal correlation was calculated as the correlation coefficient
of the average responses to stimulus. Noise correlation was found by subtracting the
average response from the responses to each trail, and then calculating the correlation coefficient of mean-subtracted responses.
In vitro whole-cell recording. We carried out imaging experiments on a total of
16 mice that were followed by patch-clamp recordings in vitro. After the functional
properties of individual neurons had been determined in vivo by two-photon
calcium imaging, the mouse brain was rapidly removed and dissected in ice-cold
ACSF containing 125 mM NaCl, 2.5 mM KCl, 1 mM MgCl2, 1.25 mM NaH2PO4,
2 mM CaCl2, 26 mM NaHCO3, 25 mM dextrose; osmolarity 315–325 mOsm,
bubbled with 95% O2/5% CO2, pH 7.4. Visual cortex slices (300 mm) were cut
coronally (HM 650 V Vibration Microtome, MICROM) and were incubated at
34 uC for thirty minutes before they were transferred to the recording chamber.
The slice containing the imaged region was identified by the presence of OGB-1
green fluorescence and the red microsphere injection site. To reveal the relative
locations of cells, a detailed morphological stack of the slice was acquired with a
custom-built microscope and a mode-locked Ti:sapphire laser (Chameleon,
Coherent) at 830 nm through a 316 water immersion objective (0.8 NA,
Nikon). Scanning and image acquisition were controlled by custom software
written in LabVIEW. Whole-cell recordings from up to four cells were carried
out in regions identified by visually comparing image stacks obtained in vivo and
in vitro, using red fluorescent microspheres and the pial surface as reference. At
this point, the experimenter was blind to the functional identity of the recorded
neurons. Recordings were carried out in 28 uC ACSF, using Multiclamp 700B
amplifiers (Axon Instruments) and data were acquired using custom software36
running in Igor Pro (WaveMetrics). Recording pipettes were filled with internal
solution containing 5 mM KCl, 115 mM K-gluconate, 10 mM K-HEPES, 4 mM
MgATP, 0.3 mM NaGTP, 10 mM Na-phosphocreatine, 0.1% w/v biocytin, 40 mM
Alexa Fluor 594; osmolarity 290–295 mOsm, pH 7.2. The chloride reversal potential was approximately 285.2 mV. Junction potential was not corrected for. Cells
were approached under visual guidance using laser-scanning Dodt contrast
imaging. After break-through, the presence of synaptic connections was tested
using five suprathreshold 5-ms-long current pulses delivered as 30-Hz trains into
each cell sequentially while monitoring for postsynaptic responses in the other
cells, repeated at least 30 times at 15-s intervals. Postsynaptic traces were averaged,
and monosynaptic excitatory connections were deemed present when there were
action-potential-locked depolarizing postsynaptic potentials associated with all
five presynaptic spikes that exhibited millisecond latency37. Latency was measured
as the time between the peak of the action potential and 5% of the EPSP. If no
spike-locked depolarizing postsynaptic potentials was present, up to 60 additional
repetitions were acquired to ensure the absence of a postsynaptic response. With
this approach, unitary EPSPs as small as 0.015 mV have been reported previously5,
the smallest EPSP in the present data set was 0.035 mV. PPR was calculated as the
amplitude of the second evoked EPSP over that of the first one. Input resistance
was monitored throughout recordings by measuring the steady-state membrane
potential change due to brief 225 pA current injections. After connectivity mapping, step currents from 250 pA to 700 pA were injected at 50 pA increments and
spike threshold was measured from the inflexion point of the minimally suprathreshold trace. Spike height was the difference between spike threshold and peak.
Spike half-width was measured at the mean of threshold and peak. Pyramidal
neurons were identified according to morphology in Alexa 594 filled image stacks
(Fig. 2a), electrophysiological properties (resting membrane potential approximately 280 mV, spike half-width .1 ms, spike height ,80 mV, regular spiking
pattern typical of pyramidal neurons with current injection, see Supplementary
Fig. 2c–e) and, in the presence of connections, depolarizing postsynaptic potentials
(Figs 2c, 3b).

©2011 Macmillan Publishers Limited. All rights reserved

LETTER RESEARCH
Registration of in vivo and in vitro image stacks. To accurately match up in vivo
and in vitro image stacks and to locate neurons of known in vivo functional preference, three-dimensional image registration using custom-written MATLAB software was performed after patch-clamp experiments. The two stacks containing the
same region to be matched differ in rotation and translation, as well as scales along
axes. In other words, taking the centre of each stack as origin, the same points in the
two stacks can be related by affine transformation. This can be written as
y~Axzb
Where x and y are column vectors of coordinates in in vivo and in vitro stack,
respectively, A is a 3 3 3 matrix representing linear transformation, and b is the
translation. To find the affine transformation four pairs of corresponding points,
(xi ,y i ), where i~1, 2, 3, 4, were manually picked from the stacks, using landmarks
such as blood vessel bifurcations, fluorescent bead injections, cortical surface, and/
or brightly labelled astrocytes. The relationship between the first pair of points
(x1 ,y1 ) is
y1 ~Ax1 zb
b~y 1 {Ax1
Substitute this into
A½ x2

x4 z½ b b b ~½ y 2

x3

y3

y4 

and let x0i ~xi {x1 , y 0i ~yi {y1 , where i~2, 3, 4, gives
Að½ x2

x3

x4 {½ x1
A½ x02

x1
x03

x1 Þ~½ y2

y3

y4 {½ y 1

x04 ~½ y02

y03

y04 

A~½ y02

y03

y04 ½ x02

y1
x03

y1 
x04 {1

Knowing the linear transformation A, b can also be found.
In practice, to assist the process of identifying corresponding points, after
picking three pairs of points, the image stacks were both rotated such that the
planes containing the three pairs of points became parallel to the x–y plane, and the
in vitro stack was further transformed such that the stacks became roughly registered in two dimensions on the planes but not along the z-axis (Supplementary Fig.
for rotating in vivo and in vitro
1a, b). To do this, let Rv and RÂt be the matrices
ÃT
stacks respectively, and let u~ ux uy uz be a unit vector, the matrix for rotating a point around u by angle h (right handedly) is given by
2
3
uy
0
{uz
À
Á
6 u
0
{ux 7
R~4 z
5 sin hz I{uuT cos hzuuT
{uy
ux
0
where I is the identity matrix. To rotate the in vivo stack such that the plane
containing the first three points picked becomes parallel to the x–y plane, the
vector and the angle are
À 0
Á
x2 |x03 |ez
uv ~
kðx02 |x03 Þ|ez k
hv ~ cos{1

À

Á 
x02 |x03 :ez
kx02 |x03 k

where ez ~½ 0 0 1 T , | denotes cross product, : denotes dot product and kk
denotes norm. Substituting these into the formula for rotation matrix above, we
can find Rv , and similarly Rt can also be found. To register the two planes in two
dimensions, a further linear transformation parallel to the x–y plane can be applied
to the in vitro stack. Let x0iR be the x, y components of Rv x0i , and y 0iR be the x, y
components of Rt y 0i , where i~2, 3, the matrix M needed for the two-dimensional
transformation is given by
M½ y02R

y 03R ~½ x02R
M~½ x02R

x03R 
x03R ½ y 02R

y03R {1

Therefore, the transformation Tt applied to the in vitro stack is
!
M 0
Rt
Tt ~
0 1
After this step, we picked one more pair of corresponding points from a plane
different from the plane that contained the initial three pairs of points
(Supplementary Fig. 1b, lower panel), which is necessary for ½ x02 x03 x04  and

½ y 02 y 03 y 04  to be invertible, A can then be found and applied to the in vivo stack.
With the affine transformation known, we could find the correspondence between
points. When rotating or transforming the image stacks, trilinear interpolation
was used to assign pixel values. After registration, we inspected several planes of
the transformed stack containing neurons recorded in vitro and made use of threedimensional relationships of nearby cells to visually verify the matching (compare
Fig. 1g, h and Supplementary Fig. 1c). Among 126 pyramidal neurons patched,
matching was successful for 116 while 10 failed: 3 cells were occluded in the in vivo
stack by a blood vessel, and 7 cells did not show convincing matching in three
dimensions on visual inspection.
Analysis of connection probabilities. Connection probabilities were calculated
as the number of connections detected over the number of potential connections
assayed. For example, with one quadruplet there are 4 3 3 5 12 potential connections, and if two connections were detected the corresponding figure would be
2/12. Probabilities of unidirectional and bidirectional connections were calculated
as the number of unidirectionally and bidirectionally connected pairs over the
total number of pairs, respectively. To relate connectivity to functional properties,
the asymptotic Cochran–Armitage test for trend was used to test for significance38.
Scores of [2, 1, 0] and [2, 1, 0, 1, 2] were used in the test to relate connection
probability or probability of finding bidirectionally connected pairs to increase in
DOri among orientation selective pairs and direction selective pairs, respectively.
Scores of [0, 1, 2, 3, 4] were used to relate connection probability or probability of
finding bidirectionally connected pairs to the increase in signal correlation. To
relate connection probability to increase in noise correlation, scores of [0, 1, 2]
were used.
Criteria for inclusion in data analysis. After patching, image stacks of patched
neurons filled with Alexa 594 were taken and coordinates of approximate centres
of neuronal somata were manually picked in a custom-written MATLAB program. The distance between the slice surface right above the patched neuron and
the soma centre was taken as the depth of neuron from the slice surface. Only
neuronal pairs in which both neurons were located at .60 mm depth and with an
inter-soma distance of ,50 mm were included in the analysis relating connectivity
to visual functional properties. On average we patched 7.9 neurons (range: 2–14)
and assayed 13.9 potential connections (range: 2–31) per slice for neuronal pairs
located deeper than 60 mm in the slice and separated by less than 50 mm.
Neuronal pairs closer to the slice surface are more likely to have connections
severed, and we found a significant increase in the probability of finding connections with the depth of the potential presynaptic neuron (P 5 0.043, Cochran–
Armitage test) or postsynaptic neuron (P 5 0.041, Cochran–Armitage test)
(Supplementary Fig. 6a, b). However, inclusion of cell pairs closer to the slice
surface (which increases the false-negative rate of connection detection), or
increasing the depth criteria (which reduces sample size) in analysis did not change
the main findings (Supplementary Fig. 6d–f). Between neuronal pairs located
deeper than 60 mm from the slice surface, 222 connections were assayed between
pairs separated by less than 50 mm. We did not find a significant difference in
connection probability for neuronal pairs separated by less than 25 mm compared
to those spaced farther apart (P 5 0.594, chi-squared test; Supplementary Fig. 6c).
In 18 out of 113 pairs, high-quality recording was achieved in one cell only (for
example, the other cell was very depolarized/unhealthy, or the seal resistance was
less than 1 GV). As action potentials could still be evoked in both neurons, these
pairs were included as pairs in which connectivity was assayed in the direction
from the unhealthy cell to the healthy cell only. Data from these pairs were
included in the analysis of connection probability, but not in the analysis of
probability of finding bidirectional or unidirectional pairs. Analysis of intrinsic
electrophysiological properties was carried out only if series resistance was less
than 30 MV.
31. Smith, S. L. & Trachtenberg, J. T. Experience-dependent binocular competition in
the visual cortex begins at eye opening. Nature Neurosci. 10, 370–375 (2007).
32. Rochefort, N. L. et al. Sparsification of neuronal activity in the visual cortex at eyeopening. Proc. Natl Acad. Sci. USA 106, 15049–15054 (2009).
33. Brainard, D. H. The Psychophysics Toolbox. Spat. Vis. 10, 433–436 (1997).
34. Pelli, D. G. The VideoToolbox software for visual psychophysics: transforming
numbers into movies. Spat. Vis. 10, 437–442 (1997).
35. Vogelstein, J. T. et al. Fast non-negative deconvolution for spike train inference
from population calcium imaging. J. Neurophysiol. (2010).
36. Sjo¨stro¨m, P. J., Turrigiano, G. G. & Nelson, S. B. Rate, timing, and cooperativity
jointly determine cortical synaptic plasticity. Neuron 32, 1149–1164 (2001).
37. Debanne, D. et al. Paired-recordings from synaptically coupled cortical and
hippocampal neurons in acute and cultured brain slices. Nature Protocols 3,
1559–1568 (2008).
38. Agresti, A. Categorical Data Analysis 2nd edn (Wiley InterScience, 2002).

©2011 Macmillan Publishers Limited. All rights reserved

